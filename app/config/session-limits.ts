/**
 * ðŸ”’ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ð¹ ÑÐµÑÑÐ¸Ð¸
 * Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¾Ñ‚ Ð¼Ð½Ð¾Ð³Ð¾Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¸ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
 */

// ===== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ Ð’Ð Ð•ÐœÐ•ÐÐ˜ Ð¡Ð•Ð¡Ð¡Ð˜Ð˜ =====
export const SESSION_LIMITS = {
  // ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ ÑÐµÑÑÐ¸Ð¸ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 5 Ð¼Ð¸Ð½ÑƒÑ‚)
  MAX_SESSION_DURATION_MINUTES: 5,
  
  // ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ (Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ… Ð´Ð¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ)
  WARNING_TIMES: [3, 2, 1], // ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ´Ð¸Ð¼ Ð·Ð° 3, 2 Ð¸ 1 Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ
  
  // Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…
  TIME_CHECK_INTERVAL_SECONDS: 30,
  
  // ÐœÑÐ³ÐºÐ¾Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ (Ð²Ñ€ÐµÐ¼Ñ Ð½Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¾Ñ‚Ð²ÐµÑ‚Ð° Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…)
  GRACEFUL_SHUTDOWN_SECONDS: 30
} as const;

// ===== ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ˜ Ð‘Ð›ÐžÐšÐ˜Ð ÐžÐ’ÐšÐ˜ ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð•Ð™ =====
export const USER_LIMITS = {
  // ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
  MAX_CONCURRENT_USERS: 1,
  
  // Ð’Ñ€ÐµÐ¼Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ ÑÐµÑÑÐ¸Ð¸ (Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹)
  QUEUE_TIMEOUT_MINUTES: 10,
  
  // Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ (ÑÐµÐºÑƒÐ½Ð´Ñ‹)
  QUEUE_CHECK_INTERVAL_SECONDS: 5,
  
  // Ð’Ñ€ÐµÐ¼Ñ Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ¸ Ð¿Ð¾ÑÐ»Ðµ Ð´Ð¸ÑÐºÐ¾Ð½Ð½ÐµÐºÑ‚Ð° (ÑÐµÐºÑƒÐ½Ð´Ñ‹, Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¹)
  COOLDOWN_SECONDS: 3
} as const;

// ===== Ð¡ÐžÐžÐ‘Ð©Ð•ÐÐ˜Ð¯ Ð”Ð›Ð¯ ÐŸÐžÐ›Ð¬Ð—ÐžÐ’ÐÐ¢Ð•Ð›Ð•Ð™ =====
export const SESSION_MESSAGES = {
  // ÐšÐ¾Ð³Ð´Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ, Ð½Ð¾ Ð¼ÐµÑÑ‚Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¾
  QUEUE_MESSAGE: `ðŸ”’ ÐÑÑÐ¸ÑÑ‚ÐµÐ½Ñ‚ ÑÐµÐ¹Ñ‡Ð°Ñ Ð·Ð°Ð½ÑÑ‚ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¼.\nâ° ÐœÐµÑÑ‚Ð¾ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸: {position}\nâ³ ÐžÐ¶Ð¸Ð´Ð°Ð¹Ñ‚Ðµ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½Ð¸Ñ Ð¸Ð»Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.`,
  
  // ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´ÐµÐ½Ð¸Ñ Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸
  TIME_WARNING: `â° Ð£ Ð²Ð°Ñ Ð¾ÑÑ‚Ð°Ð»Ð¾ÑÑŒ {minutes} Ð¼Ð¸Ð½ÑƒÑ‚ Ð´Ð¾ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ ÑÐµÑÑÐ¸Ð¸.`,
  TIME_WARNING_FINAL: `âš ï¸ Ð¡ÐµÑÑÐ¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· {seconds} ÑÐµÐºÑƒÐ½Ð´. Ð—Ð°Ð²ÐµÑ€ÑˆÐ°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ð¹ Ð²Ð¾Ð¿Ñ€Ð¾Ñ.`,
  
  // Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ ÑÐµÑÑÐ¸Ð¸
  SESSION_EXPIRED: `â° Ð’Ñ€ÐµÐ¼Ñ ÑÐµÑÑÐ¸Ð¸ Ð¸ÑÑ‚ÐµÐºÐ»Ð¾ (${SESSION_LIMITS.MAX_SESSION_DURATION_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚). Ð¡ÐµÑÑÐ¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°.\nðŸ”„ ÐœÐ¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ ÑÐµÑÑÐ¸ÑŽ.`,
  SESSION_INTERRUPTED: `ðŸ”’ Ð’Ð°ÑˆÐ° ÑÐµÑÑÐ¸Ñ Ð±Ñ‹Ð»Ð° Ð¿Ñ€ÐµÑ€Ð²Ð°Ð½Ð° Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð¸Ð»Ð¸ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼Ð¸ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð°Ð¼Ð¸.`,
  
  // Ð£ÑÐ¿ÐµÑˆÐ½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
  SESSION_STARTED: `âœ… ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾. Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ ${SESSION_LIMITS.MAX_SESSION_DURATION_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚.`,
  
  // ÐžÑ‡ÐµÑ€ÐµÐ´ÑŒ
  QUEUE_POSITION_UPDATE: `ðŸ“ Ð’Ð°ÑˆÐ° Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ñ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸: {position}`,
  QUEUE_YOUR_TURN: `ðŸŽ‰ Ð’Ð°ÑˆÐ° Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ! ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ...`,
  QUEUE_TIMEOUT: `â° Ð’Ñ€ÐµÐ¼Ñ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´Ð¸ Ð¸ÑÑ‚ÐµÐºÐ»Ð¾ (${USER_LIMITS.QUEUE_TIMEOUT_MINUTES} Ð¼Ð¸Ð½ÑƒÑ‚). ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.`
} as const;

// ===== Ð¢Ð˜ÐŸÐ« =====
export interface SessionInfo {
  sessionId: string;
  userId: string;
  startTime: number;
  isActive: boolean;
  timeRemaining: number;
}

export interface QueuePosition {
  userId: string;
  position: number;
  joinTime: number;
  estimatedWaitTime: number; // Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ…
}

export interface SessionStats {
  activeSessions: number;
  queueLength: number;
  cooldownUsers: number;
  timeSinceLastSessionEnd: number;
}

// ===== Ð£Ð¢Ð˜Ð›Ð˜Ð¢Ð« =====
export const formatTimeRemaining = (minutes: number): string => {
  if (minutes >= 60) {
    const hours = Math.floor(minutes / 60);
    const remainingMinutes = minutes % 60;
    return `${hours}Ñ‡ ${remainingMinutes}Ð¼`;
  }
  return `${minutes}Ð¼`;
};

export const formatMessage = (template: string, params: Record<string, any>): string => {
  return template.replace(/\{(\w+)\}/g, (match, key) => params[key] || match);
}; 